syntax = "proto3";

package valkey_timeseries.fanout;

message Label {
  string name = 1;
  string value = 2;
}

message Sample {
  int64 timestamp = 1;
  double value = 2;
}

enum CompressionType {
  UNCOMPRESSED = 0;
  GORILLA = 1;
  PCO = 2;
}

message SampleData {
  uint32 version = 1;
  CompressionType compression = 2;
  bytes data = 3;
}

message SeriesChunk {
  string key = 1;
  string group_value = 2;
  repeated Label labels = 3;
  SampleData data = 4;
}

message MGetValue {
  string key = 1;
  Sample sample = 2;
  repeated Label labels = 3;
}

message SeriesRangeResponse {
  string key = 1;
  string group_label_value = 2;
  repeated Label labels = 3;
  SampleData samples = 4;
}

message MultiGetResponse {
  repeated MGetValue values = 1;
}

message MDelResponse {
  uint64 deleted_count = 1;
}

message MultiRangeResponse {
  repeated SeriesRangeResponse series = 1;
}

message IndexQueryResponse {
  repeated string keys = 1;
}

enum ErrorKind {
  FAILED = 0;
  NODE_UNREACHABLE = 1;
  TIMEOUT = 2;
  UNKNOWN_MESSAGE_TYPE = 3;
  PERMISSION_DENIED = 4;
  KEY_PERMISSION_DENIED = 5;
  SERIALIZATION = 6;
  BAD_REQUEST = 7;
  INTERNAL = 8;
  GENERIC = 9;
}

message ErrorResponse {
  ErrorKind kind = 1;
  string message = 2;
}

message LabelValuesResponse {
  repeated string values = 1;
}

message LabelNamesResponse {
  repeated string names = 1;
}

message CardinalityResponse {
  uint64 cardinality = 1;
}

message PostingStat {
  string name = 1;
  uint64 count = 2;
}

message StatsResponse {
  uint64 series_count = 1;
  repeated PostingStat series_count_by_metric_name = 2;
  repeated PostingStat series_count_by_label_name = 3;
  repeated PostingStat series_count_by_label_value_pairs = 4;
  repeated PostingStat series_count_by_focus_label_value = 5;
  bytes labels_bitmap = 6;
  bytes label_value_pairs_bitmap = 7;
}